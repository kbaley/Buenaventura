@page "/"
@using ApexCharts;
@inject IDashboardService dashboardService;

@attribute [Authorize]

<MudText Typo="Typo.h4" GutterBottom="true">Dashboard</MudText>

<MudGrid>

    <MudItem xs="12" md="9">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="IncomeExpenseDataPoint"
                       Title="Income vs. Expenses (Last 12 Months)"
                       Height="320"
            >
                <ApexPointSeries
                    TItem="IncomeExpenseDataPoint"
                    Items="incomeExpenseData"
                    Name="Income"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Income)"
                    SeriesType="SeriesType.Bar"
                />
                <ApexPointSeries
                    TItem="IncomeExpenseDataPoint"
                    Items="incomeExpenseData"
                    Name="Expenses"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Expenses)"
                    SeriesType="SeriesType.Bar"
                />
                <ApexPointSeries
                    TItem="IncomeExpenseDataPoint"
                    Items="incomeExpenseData"
                    Name="Difference"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.CashFlow)"
                    SeriesType="SeriesType.Line"
                />
            </ApexChart>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" md="3">
        <MudGrid>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Cash Flow This Month</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Success">$2,500</MudText>
                </MudPaper>
            </MudItem>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Credit Card Total</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Error">@(creditCardBalance.ToString("C"))</MudText>
                </MudPaper>
            </MudItem>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Bank Account Total</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Success">@(liquidAssetBalance.ToString("C"))</MudText>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </MudItem>

    <!-- Investment Value Over Time -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="LineChartDataPoint"
                       Title="Investment Value Over Time"
            >
                <ApexPointSeries
                    TItem="LineChartDataPoint"
                    Items="investmentData"
                    Name="Investment Value"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Amount)"
                    SeriesType="SeriesType.Line"
                />
            </ApexChart>
        </MudPaper>
    </MudItem>

    <!-- Net Worth Over Last 12 Months -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="LineChartDataPoint"
                       Title="Net Worth Over Time"
            >
                <ApexPointSeries
                    TItem="LineChartDataPoint"
                    Items="investmentData"
                    Name="Investment Value"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Amount)"
                    SeriesType="SeriesType.Line"
                />
            </ApexChart>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="ExpenseDataPoint"
                       Title="Expense Breakdown by Category"
                       Height="300">
                <ApexPointSeries
                    TItem="ExpenseDataPoint"
                    Items="expenseData"
                    Name="Expenses"
                    SeriesType="SeriesType.Pie"
                    XValue="@(e => e.Category)"
                    YValue="@(e => e.Amount)"/>
            </ApexChart>
        </MudPaper>
    </MudItem>

    <!-- Asset Class Breakdown -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="ExpenseDataPoint"
                       Title="Asset Class Breakdown"
                       Height="300">
                <ApexPointSeries
                    TItem="ExpenseDataPoint"
                    Items="assetData"
                    Name="Expenses"
                    SeriesType="SeriesType.Donut"
                    XValue="@(e => e.Category)"
                    YValue="@(e => e.Amount)"/>
            </ApexChart>
        </MudPaper>
    </MudItem>

    <!-- Top 5 Expenses -->
    <!-- Show bar chart with three bars per category: Current Month, Previous 3 months average, and Yearly average -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="Top5ExpenseDataPoint"
                       Title="Top 5 Expenses"
                       Height="300"
            >
                <ApexPointSeries
                    TItem="Top5ExpenseDataPoint"
                    Items="topExpensesData"
                    Name="Current Month"
                    XValue="@(e => e.Category)"
                    YValue="@(e => e.CurrentMonth)"
                    SeriesType="SeriesType.Bar"
                />
                <ApexPointSeries
                    TItem="Top5ExpenseDataPoint"
                    Items="topExpensesData"
                    Name="3 Month Avg"
                    XValue="@(e => e.Category)"
                    YValue="@(e => e.Previous3MonthsAverage)"
                    SeriesType="SeriesType.Bar"
                />
                <ApexPointSeries
                    TItem="Top5ExpenseDataPoint"
                    Items="topExpensesData"
                    Name="12 Month Avg"
                    XValue="@(e => e.Category)"
                    YValue="@(e => e.Previous12MonthsAverage)"
                    SeriesType="SeriesType.Bar"
                />
            </ApexChart>
        </MudPaper>
    </MudItem>

    <!-- Financial Summary Cards -->
</MudGrid>

@code {
    
    private decimal creditCardBalance;
    private decimal liquidAssetBalance;

    protected override async Task OnParametersSetAsync()
    {
        creditCardBalance = await dashboardService.GetCreditCardBalance();
        liquidAssetBalance = await dashboardService.GetLiquidAssetBalance();
    }

    private readonly List<ExpenseDataPoint> expenseData =
    [
        new() { Category = "Housing", Amount = 35 },
        new() { Category = "Food", Amount = 25 },
        new() { Category = "Transportation", Amount = 15 },
        new() { Category = "Entertainment", Amount = 10 },
        new() { Category = "Utilities", Amount = 15 },
        new() { Category = "Other", Amount = 18 }
    ];

    private readonly List<LineChartDataPoint> investmentData =
    [
        new() { Month = "May 2024", Amount = 10000 },
        new() { Month = "Jun 2024", Amount = 12000 },
        new() { Month = "Jul 2024", Amount = 15000 },
        new() { Month = "Aug 2024", Amount = 13000 },
        new() { Month = "Sep 2024", Amount = 14000 },
        new() { Month = "Oct 2024", Amount = 16000 },
        new() { Month = "Nov 2024", Amount = 17000 },
        new() { Month = "Dec 2024", Amount = 18000 },
        new() { Month = "Jan 2025", Amount = 19000 },
        new() { Month = "Feb 2025", Amount = 20000 },
        new() { Month = "Mar 2025", Amount = 21000 },
        new() { Month = "Apr 2025", Amount = 22000 }
    ];

    private readonly List<ExpenseDataPoint> assetData =
    [
        new() { Category = "Bank Accounts", Amount = 35 },
        new() { Category = "Investments", Amount = 25 },
        new() { Category = "Assets", Amount = 15 },
    ];


    private List<Top5ExpenseDataPoint> topExpensesData =
    [
        new() { Category = "Housing", CurrentMonth = 1200, Previous3MonthsAverage = 1100, Previous12MonthsAverage = 1000 },
        new() { Category = "Food", CurrentMonth = 800, Previous3MonthsAverage = 700, Previous12MonthsAverage = 600 },
        new() { Category = "Transportation", CurrentMonth = 600, Previous3MonthsAverage = 500, Previous12MonthsAverage = 400 },
        new() { Category = "Entertainment", CurrentMonth = 400, Previous3MonthsAverage = 350, Previous12MonthsAverage = 300 },
        new() { Category = "Utilities", CurrentMonth = 300, Previous3MonthsAverage = 250, Previous12MonthsAverage = 200 }
    ];

    private readonly List<IncomeExpenseDataPoint> incomeExpenseData =
    [
        new() { Date = new DateOnly(2024, 5, 1), Income = 4200, Expenses = 3100 },
        new() { Date = new DateOnly(2024, 6, 1), Income = 3900, Expenses = 3300 },
        new() { Date = new DateOnly(2024, 7, 1), Income = 5000, Expenses = 2900 },
        new() { Date = new DateOnly(2024, 8, 1), Income = 4800, Expenses = 3200 },
        new() { Date = new DateOnly(2024, 9, 1), Income = 5100, Expenses = 3400 },
        new() { Date = new DateOnly(2024, 10, 1), Income = 4700, Expenses = 3100 },
        new() { Date = new DateOnly(2024, 11, 1), Income = 4600, Expenses = 3600 },
        new() { Date = new DateOnly(2024, 12, 1), Income = 4900, Expenses = 3700 },
        new() { Date = new DateOnly(2025, 1, 1), Income = 5300, Expenses = 4000 },
        new() { Date = new DateOnly(2025, 2, 1), Income = 5000, Expenses = 3900 },
        new() { Date = new DateOnly(2025, 3, 1), Income = 5200, Expenses = 4100 },
        new() { Date = new DateOnly(2025, 4, 1), Income = 5500, Expenses = 4200 }
    ];

    public class ExpenseDataPoint
    {
        public string Category { get; set; } = "";
        public decimal Amount { get; set; }
    }

    public class LineChartDataPoint
    {
        public string Month { get; set; } = "";
        public decimal Amount { get; set; }
    }

    private class Top5ExpenseDataPoint
    {
        public string Category { get; set; } = "";
        public decimal CurrentMonth { get; set; }
        public decimal Previous3MonthsAverage { get; set; }
        public decimal Previous12MonthsAverage { get; set; }
    }

}
