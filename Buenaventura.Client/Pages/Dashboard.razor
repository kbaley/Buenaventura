@page "/"
@using ApexCharts;
@using Buenaventura.Client.Components.DashboardCharts

@attribute [Authorize]

<MudText Typo="Typo.h4" GutterBottom="true">Dashboard</MudText>

<MudGrid>

    <MudItem xs="12" md="9">
        <MudPaper Elevation="1" Class="pa-4" Height="367px">
            <IncomeExpenseChart IsLoading="@isLoading"
                                IncomeExpenseData="@incomeExpenseData"
            />
        </MudPaper>
    </MudItem>
    <MudItem xs="12" md="3">
        <MudGrid>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Expenses This Month</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Success">@(expensesThisMonth.ToString("C"))</MudText>
                </MudPaper>
            </MudItem>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Credit Card Total</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Error">@(creditCardBalance.ToString("C"))</MudText>
                </MudPaper>
            </MudItem>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Bank Account Total</MudText>
                    <MudText Typo="Typo.h4"
                             Color="MudBlazor.Color.Success">@(liquidAssetBalance.ToString("C"))</MudText>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </MudItem>

    <!-- Investment Value Over Time -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4" Height="418px">
            <LineChart 
                IsLoading="isLoading"
                ChartData="investmentData"
                Title="Investment Value Over Time"
            />
        </MudPaper>
    </MudItem>

    <!-- Net Worth Over Last 12 Months -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4" Height="418px">
            <LineChart
                IsLoading="isLoading"
                ChartData="netWorthData"
                Title="Net Worth Over Time"
            />
        </MudPaper>
    </MudItem>

    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            @if (isLoading)
            {
                <MudProgressCircular Indeterminate="true" Color="MudBlazor.Color.Primary"/>
            }
            else
            {
                <ApexChart TItem="ReportDataPoint"
                           Title="Expense Breakdown by Category"
                           Height="300">
                    <ApexPointSeries
                        TItem="ReportDataPoint"
                        Items="expenseData"
                        Name="Expenses"
                        SeriesType="SeriesType.Pie"
                        XValue="@(e => e.Label)"
                        YValue="@(e => e.Value)"
                        ShowDataLabels="true"/>
                </ApexChart>
            }
        </MudPaper>
    </MudItem>

    <!-- Asset Class Breakdown -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            @if (isLoading)
            {
                <MudProgressCircular Indeterminate="true" Color="MudBlazor.Color.Primary"/>
            }
            else
            {
                <ApexChart TItem="ExpenseDataPoint"
                           Title="Asset Class Breakdown"
                           Height="300">
                    <ApexPointSeries
                        TItem="ExpenseDataPoint"
                        Items="assetData"
                        Name="Expenses"
                        SeriesType="SeriesType.Donut"
                        XValue="@(e => e.Category)"
                        YValue="@(e => e.Amount)"/>
                </ApexChart>
            }
        </MudPaper>
    </MudItem>

    <!-- Top 5 Expenses -->
    <!-- Show bar chart with three bars per category: Current Month, Previous 3 months average, and Yearly average -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            @if (isLoading)
            {
                <MudProgressCircular Indeterminate="true" Color="MudBlazor.Color.Primary"/>
            }
            else
            {
                <ApexChart TItem="Top5ExpenseDataPoint"
                           Title="Top 5 Expenses"
                           Height="300">
                    <ApexPointSeries
                        TItem="Top5ExpenseDataPoint"
                        Items="topExpensesData"
                        Name="Current Month"
                        XValue="@(e => e.Category)"
                        YValue="@(e => e.CurrentMonth)"
                        SeriesType="SeriesType.Bar"/>
                    <ApexPointSeries
                        TItem="Top5ExpenseDataPoint"
                        Items="topExpensesData"
                        Name="3 Month Avg"
                        XValue="@(e => e.Category)"
                        YValue="@(e => e.Previous3MonthsAverage)"
                        SeriesType="SeriesType.Bar"/>
                    <ApexPointSeries
                        TItem="Top5ExpenseDataPoint"
                        Items="topExpensesData"
                        Name="12 Month Avg"
                        XValue="@(e => e.Category)"
                        YValue="@(e => e.Previous12MonthsAverage)"
                        SeriesType="SeriesType.Bar"/>
                </ApexChart>
            }
        </MudPaper>
    </MudItem>

</MudGrid>