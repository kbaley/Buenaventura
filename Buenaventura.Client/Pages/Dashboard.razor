@page "/"
@using ApexCharts;
@using System.Globalization

@attribute [Authorize]

<MudText Typo="Typo.h4" GutterBottom="true">Dashboard</MudText>

<MudGrid>

    <MudItem xs="12" md="9">
        <MudPaper Elevation="1" Class="pa-4">
            <ApexChart TItem="IncomeExpenseDataPoint"
                       Title="Income vs. Expenses (Last 12 Months)"
                       Height="300"
            >
                <ApexPointSeries 
                    TItem="IncomeExpenseDataPoint"
                    Items="incomeExpenseData"
                    Name="Income"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Income)"
                    SeriesType="SeriesType.Bar"
                />
                <ApexPointSeries
                    TItem="IncomeExpenseDataPoint"
                    Items="incomeExpenseData"
                    Name="Expenses"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Expenses)"
                    SeriesType="SeriesType.Bar"
                />
                <ApexPointSeries
                    TItem="IncomeExpenseDataPoint"
                    Items="incomeExpenseData"
                    Name="Difference"
                    XValue="@(e => e.Month)"
                    YValue="@(e => e.Difference)"
                    SeriesType="SeriesType.Line"
                />
            </ApexChart>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" md="3">
        <MudGrid>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Cash Flow This Month</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Success">$2,500</MudText>
                </MudPaper>
            </MudItem>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Credit Card Total</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Error">$1,200</MudText>
                </MudPaper>
            </MudItem>
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h6">Bank Account Total</MudText>
                    <MudText Typo="Typo.h4" Color="MudBlazor.Color.Success">$15,000</MudText>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </MudItem>


    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Expense Breakdown by Category</MudText>
            <MudChart ChartType="MudBlazor.ChartType.Pie" InputData="@expenseData" InputLabels="@expenseLabels"/>
        </MudPaper>
    </MudItem>

    <!-- Investment Value Over Time -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Investment Value Over Time</MudText>
            <MudChart ChartType="MudBlazor.ChartType.Line" ChartSeries="@investmentData"/>
        </MudPaper>
    </MudItem>

    <!-- Net Worth Over Last 12 Months -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Net Worth Over Last 12 Months</MudText>
            <MudChart ChartType="MudBlazor.ChartType.Line" ChartSeries="@netWorthData"/>
        </MudPaper>
    </MudItem>

    <!-- Asset Class Breakdown -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Asset Class Breakdown</MudText>
            <MudChart ChartType="MudBlazor.ChartType.Pie" ChartSeries="@assetData"/>
        </MudPaper>
    </MudItem>

    <!-- Top 5 Expenses -->
    <MudItem xs="12" md="6">
        <MudPaper Elevation="1" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Top 5 Expenses</MudText>
            <MudChart ChartType="MudBlazor.ChartType.Bar" ChartSeries="@topExpensesData"/>
        </MudPaper>
    </MudItem>

    <!-- Financial Summary Cards -->
</MudGrid>

@code {

    private ChartOptions options = new ChartOptions
    {
        ChartPalette = new string[] { "#3E2723", "#4E342E", "#5D4037", "#6D4C41", "#795548", "#8D6E63", "#A1887F", "#BCAAA4", "#D7CCC8", "#EFEBE9" }
    };

    private double[] expenseData = { 35, 25, 15, 10, 15 };
    private string[] expenseLabels = { "Housing", "Food", "Transportation", "Entertainment", "Utilities" };

    private List<ChartSeries> investmentData = new()
    {
        new ChartSeries { Name = "Investments", Data = new double[] { 50000, 52000, 51000, 53000, 55000, 57000, 56000, 58000, 60000, 62000, 63000, 65000 } }
    };

    private List<ChartSeries> netWorthData = new()
    {
        new ChartSeries { Name = "Net Worth", Data = new double[] { 100000, 102000, 105000, 108000, 110000, 112000, 115000, 118000, 120000, 122000, 125000, 128000 } }
    };

    private List<ChartSeries> assetData = new()
    {
        new ChartSeries { Name = "Stocks", Data = new double[] { 40 } },
        new ChartSeries { Name = "Bonds", Data = new double[] { 30 } },
        new ChartSeries { Name = "Real Estate", Data = new double[] { 20 } },
        new ChartSeries { Name = "Cash", Data = new double[] { 10 } }
    };

    private List<ChartSeries> topExpensesData = new()
    {
        new ChartSeries { Name = "Expenses", Data = new double[] { 1200, 800, 600, 400, 300 } }
    };

    private string[] Months => Enumerable.Range(0, 12)
        .Select(i => DateTime.Now.AddMonths(-11 + i).ToString("MMM", CultureInfo.InvariantCulture))
        .ToArray();

    private readonly List<ChartSeries> incomeExpenseSeries =
    [
        new() { Name = "Income", Data = [4200, 3900, 5000, 4800, 5100, 4700, 4600, 4900, 5300, 5000, 5200, 5500] },
        new() { Name = "Expenses", Data = [3100, 3300, 2900, 3200, 3400, 3100, 3600, 3700, 4000, 3900, 4100, 4200] }
    ];

    private readonly List<IncomeExpenseDataPoint> incomeExpenseData =
    [
        new() { Month = "May 2024", Date = new DateOnly(2024, 5, 1), Income = 4200, Expenses = 3100 },
        new() { Month = "Jun 2024", Date = new DateOnly(2024, 6, 1), Income = 3900, Expenses = 3300 },
        new() { Month = "Jul 2024", Date = new DateOnly(2024, 7, 1), Income = 5000, Expenses = 2900 },
        new() { Month = "Aug 2024", Date = new DateOnly(2024, 8, 1), Income = 4800, Expenses = 3200 },
        new() { Month = "Sep 2024", Date = new DateOnly(2024, 9, 1), Income = 5100, Expenses = 3400 },
        new() { Month = "Oct 2024", Date = new DateOnly(2024, 10, 1), Income = 4700, Expenses = 3100 },
        new() { Month = "Nov 2024", Date = new DateOnly(2024, 11, 1), Income = 4600, Expenses = 3600 },
        new() { Month = "Dec 2024", Date = new DateOnly(2024, 12, 1), Income = 4900, Expenses = 3700 },
        new() { Month = "Jan 2025", Date = new DateOnly(2025, 1, 1), Income = 5300, Expenses = 4000 },
        new() { Month = "Feb 2025", Date = new DateOnly(2025, 2, 1), Income = 5000, Expenses = 3900 },
        new() { Month = "Mar 2025", Date = new DateOnly(2025, 3, 1), Income = 5200, Expenses = 4100 },
        new() { Month = "Apr 2025", Date = new DateOnly(2025, 4, 1), Income = 5500, Expenses = 4200 }
    ];
    
    private class IncomeExpenseDataPoint
    {
        public string Month { get; set; } = "";
        public DateOnly Date { get; set; }
        public decimal Income { get; set; }
        public decimal Expenses { get; set; }
        public decimal Difference => Income - Expenses;
    }
}
