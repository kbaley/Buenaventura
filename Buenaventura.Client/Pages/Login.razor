@page "/login"
@using Buenaventura.Client.Services
@layout Layout.LoginLayout
@inject IAuthenticationService AuthenticationService
@inject NavigationManager Navigation

@if (!string.IsNullOrEmpty(ErrorMessage))
{
<MudAlert Severity="Severity.Error">
    @ErrorMessage
</MudAlert>
}
<MudForm Class="login-form">
    <MudTextField @bind-Value="Username" Label="Username" Required="true" Variant="Variant.Outlined"/>
    <MudTextField @bind-Value="Password" Label="Password" Required="true" Variant="Variant.Outlined"
                  InputType="InputType.Password"/>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@DoLogin">Login</MudButton>
</MudForm>

<HeadContent>
    <style>
        .login-form {
            padding-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 300px;
            margin: 0 auto;
        }
    </style>
</HeadContent>

@code {

    private string Username { get; set; } = "";
    private string Password { get; set; } = "";
    private string ErrorMessage { get; set; } = "";

    private async Task DoLogin(MouseEventArgs arg)
    {
        var authData = await AuthenticationService.Login(Username, Password);
        if (string.IsNullOrEmpty(authData.Token))
        {
            ErrorMessage = "Invalid email or password";
        }
        else
        {
            Navigation.NavigateTo("/");
        }
    }

}
